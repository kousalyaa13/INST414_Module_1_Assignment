# load library
```{python}
import pandas as pd
```

# import full DRUG dataset
```{python}
drug_info = pd.read_csv("ORIG_ASCII/DRUG25Q4.txt", sep = "$")
drug_info
```

# filter DRUG dataset by only showing isotretinoin brands
```{python}
isotretinoin_brands = [
    "ROACCUTANE",
    "ACCUTANE",
    "CLARAVIS",
    "AMNESTEEM",
    "SOTRET",
    "ABSORICA",
    "MYORISAN",
    "ZENATANE"
]

# filter product for ISOTRETINOIN
iso_drugs = drug_info[drug_info["prod_ai"] == "ISOTRETINOIN"]

# filter specific generally prescribed ISOTRETINOIN trade names
#iso_drugs = drug_info[drug_info["drugname"].isin(isotretinoin_brands)]

iso_drugs
```

# remove duplicates of the same case
# if duplicates exist, keep the row with the highest case id
```{python}
iso_drugs = iso_drugs.drop_duplicates(subset = "caseid", keep = "first")

iso_drugs
```

# only include PS = Primary Suspect
```{python}
iso_drugs = iso_drugs[iso_drugs["role_cod"] == "PS"]
iso_drugs
```

# save cleaned isotretinoin DRUG data
```{python}
iso_drugs.to_csv("ISO_DRUG_INFO.txt", sep = "$")
iso_drugs
```

# clean REAC data
```{python}
reaction_info = pd.read_csv("ORIG_ASCII\REAC25Q4.txt", sep = "$")
reaction_info
```

# join with DRUG table with primary key
```{python}
# inner join to keep only the matching reports
iso_reactions = iso_drugs.merge(reaction_info, on = "primaryid", how = "inner")
iso_reactions

# view all reactions mentioned
unique_reactions = iso_reactions["pt"].unique()
unique_reactions

# create a list of psychiatric disorders
psych_pt_list = {
    "completed suicide",
    "suicidal ideation",
    "suicide attempt",
    "self-injurious ideation",
    "intentional self-injury",
    "depression",
    "depressed mood",
    "depressive symptom",
    "major depression",
    "persistent depressive disorder",
    "affective disorder",
    "mood altered",
    "mood swings",
    "affect lability",
    "irritability",
    "anxiety",
    "panic attack",
    "panic reaction",
    "nervousness",
    "agitation",
    "aggression",
    "abnormal behaviour",
    "confusional state",
    "delusion",
    "psychotic disorder",
    "post-traumatic stress disorder",
    "mental disorder",
    "psychiatric symptom",
    "mental status changes",
    "intrusive thoughts",
    "negative thoughts",
    "body dysmorphic disorder",
    "self esteem decreased",
    "stress",
    "anger",
    "homicidal ideation",
    "homicide",
    "apathy",
    "flat affect",
    "abulia",
    "brain fog",
    "sleep disorder",
    "insomnia",
    "nightmare"
}
# lower case
iso_reactions["pt_lower"] = iso_reactions["pt"].astype(str).str.lower().str.strip()
iso_reactions

# filter
psych_iso = iso_reactions[iso_reactions["pt_lower"].isin(psych_pt_list)]
psych_iso

```
