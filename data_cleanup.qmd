# load library
```{python}
import pandas as pd
```

# import full DRUG dataset
```{python}
drug_info = pd.read_csv("ORIG_ASCII/DRUG25Q4.txt", sep = "$")
drug_info #1815349 rows × 20 columns
```

# remove uneeded columns
```{python}
filtered_drug_info = drug_info.drop(columns = ["route", "rechal", "lot_num", "exp_dt", "nda_num", "dose_form", "cum_dose_chr", "cum_dose_unit"])

filtered_drug_info #1815349 rows × 12 columns
```

# filter DRUG dataset by only showing isotretinoin brands
```{python}
# filter product for ISOTRETINOIN
iso_drugs = filtered_drug_info[drug_info["prod_ai"] == "ISOTRETINOIN"]

iso_drugs #2067 rows × 12 columns
```

# remove duplicates of the same case
# if duplicates exist, keep the row with the highest case id
```{python}
iso_drugs = iso_drugs.drop_duplicates(subset = "caseid", keep = "first")

iso_drugs #1508 rows × 12 columns
```

# only include PS = Primary Suspect
```{python}
iso_drugs = iso_drugs[iso_drugs["role_cod"] == "PS"]

iso_drugs #1433 rows × 12 columns
```

# save cleaned isotretinoin DRUG data
```{python}
iso_drugs.to_csv("ISO_DRUG_INFO.txt", sep = "$")

iso_drugs
```

# load REAC data
```{python}
reaction_info = pd.read_csv("ORIG_ASCII\REAC25Q4.txt", sep = "$")

reaction_info #1349105 rows × 4 columns
```

# join with DRUG table with primary key
```{python}
# inner join to keep only the matching reports
iso_reactions = iso_drugs.merge(reaction_info, on = "primaryid", how = "inner")

iso_reactions #2265 rows × 15 columns
```

# filter by psychiatric disorder key terms
```{python}
# view all reactions mentioned
unique_reactions = iso_reactions["pt"].unique()
unique_reactions

# create a list of psychiatric disorders
psych_pt_list = {
    "completed suicide",
    "suicidal ideation",
    "suicide attempt",
    "self-injurious ideation",
    "intentional self-injury",
    "depression",
    "depressed mood",
    "depressive symptom",
    "major depression",
    "persistent depressive disorder",
    "affective disorder",
    "mood altered",
    "mood swings",
    "affect lability",
    "irritability",
    "anxiety",
    "panic attack",
    "panic reaction",
    "nervousness",
    "agitation",
    "aggression",
    "abnormal behaviour",
    "confusional state",
    "delusion",
    "psychotic disorder",
    "post-traumatic stress disorder",
    "mental disorder",
    "psychiatric symptom",
    "mental status changes",
    "intrusive thoughts",
    "negative thoughts",
    "body dysmorphic disorder",
    "self esteem decreased",
    "stress",
    "anger",
    "homicidal ideation",
    "homicide",
    "apathy",
    "flat affect",
    "abulia",
    "brain fog",
    "sleep disorder",
    "insomnia",
    "nightmare"
}
# lower case
iso_reactions["pt_lower"] = iso_reactions["pt"].astype(str).str.lower().str.strip()

# filter
psych_iso = iso_reactions[iso_reactions["pt_lower"].isin(psych_pt_list)]

psych_iso # 344 rows × 16 columns
```

# save cleaned isotretinoin REAC data
```{python}
psych_iso.to_csv("ISO_REAC_INFO.txt", sep = "$")

psych_iso
```

# clean DEMO dataset for demographic information
```{python}
demo_info = pd.read_csv("ORIG_ASCII/DEMO25Q4.txt", sep = "$", low_memory = False)
demo_info # 385288 rows × 25 columns
```

# remove uneeded columns
```{python}
filtered_demo_info = demo_info.drop(columns = ["rept_dt", "to_mfr", "e_sub", "mfr_num", "mfr_sndr", "init_fda_dt", "fda_dt", "mfr_dt", "event_dt"])
filtered_demo_info #385288 rows × 16 columns
```

# join on primary_id
```{python}
iso_demo = filtered_demo_info.merge(psych_iso, on = "primaryid", how = "inner")

iso_demo #344 rows x 31 columns
```

# save demographic data and fully cleaned data
```{python}
iso_demo.to_csv("ISO_DEMO_INFO.txt", sep = "$")

iso_demo.to_csv("ISO_CLEANED.txt", sep = "$")

iso_demo
```